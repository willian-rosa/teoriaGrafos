<!DOCTYPE html>
<html lang="en">
    <head>
        <title>three.js webgl - interactive cubes</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                font-family: Monospace;
                background-color: #f0f0f0;
                margin: 0px;
                overflow: hidden;
            }
        </style>
    </head>
    <body>

        <script src="assets/three.min.js"></script>


        <div id="content-interface"></div>

        <script>
        var contentInterface = document.getElementById('content-interface');
        var renderer, camera, scene, font, prepareNewObject;
        var vertexs = [];

        var mouse = new THREE.Vector2();
        var raycaster = new THREE.Raycaster()
        var intersection = new THREE.Vector3();
        var plane = new THREE.Plane();
        var canvasWidth = window.innerWidth, canvasHeight = window.innerHeight;


        var loader = new THREE.FontLoader();
        loader.load( 'fonts/helvetiker_regular.typeface.json', function ( fontLoad ) {
            
            font = fontLoad;

            init();
            animate();

        } );

        function factoryVertex(text, positionX, positionY){
            
            var geometry = new THREE.CircleGeometry( 1, 15 );
            var material = new THREE.MeshBasicMaterial( { color: 0x11558D } );
            var circle = new THREE.Mesh( geometry, material );
            
            
            
            var textGeo = new THREE.TextGeometry(text, {
                            font: font,
                            size: 0.7,
                            height: 0,
                            curveSegments: 3
                                            });
           
            var textMesh = new THREE.Mesh( textGeo, new THREE.MeshBasicMaterial({color: 0x000000}));
            
            textMesh.position.x = -0.8;
            textMesh.position.y = -0.3;
           
            var group = new THREE.Group();
            
            group.add( circle );
            group.add(textMesh);
            
            
            group.position.x = positionX;
            group.position.y = positionY;

            scene.add(group);
            
            vertexs.push(group);
            
        }

        function newVertex(){
            var input = document.getElementById('interface-vertece');
            prepareNewObject = {type: 'vertex', 'value': input.value};
            input.value = '';
        }

        function onMouseDown(event){
            
            event.preventDefault();

            
            if(prepareNewObject){

                mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
                mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

                raycaster.setFromCamera( mouse, camera );

                plane.setFromNormalAndCoplanarPoint( camera.getWorldDirection( plane.normal ), new THREE.Vector3() );

                raycaster.ray.intersectPlane( plane, intersection );

                intersection.sub( new THREE.Vector3());
                
                if(prepareNewObject.type === 'vertex'){
                    factoryVertex('prepareNewObject.value', intersection.x, intersection.y);
                    prepareNewObject = null;
                }
                
            }
            
        }

        function init(){
            
            renderer = new THREE.WebGLRenderer();
            renderer.setSize( canvasWidth, canvasHeight );
            renderer.setClearColor( 0xdddddd, 1);

            contentInterface.appendChild( renderer.domElement );

            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(
                45,             // Field of view
                canvasWidth / canvasHeight,      // Aspect ratio
                1,            // Near plane
                10000           // Far plane
            );
            camera.position.set(0, 0, 25);
            camera.lookAt( scene.position );

            ///////////////////////////////////////





            var dir = new THREE.Vector3( 0, 0, 0 );
            var origin = new THREE.Vector3( 0, 0, 0 );
            var length = 2;
            var hex = 0xffff00;

            var arrowHelper = new THREE.ArrowHelper( dir, origin, length, hex );
            scene.add( arrowHelper );

            /////////////////////////////////////////
            contentInterface.addEventListener('mousedown', onMouseDown, false);
            
            
            
        }

        function render(){
            renderer.setClearColor( 0xdddddd, 1);
            renderer.render( scene, camera );
        }

        function animate() {

                requestAnimationFrame( animate );

                render();

        }
        </script>

    </body>
</html>